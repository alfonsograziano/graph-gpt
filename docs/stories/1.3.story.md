# Story 1.3: Homepage and Conversation List

## Status
Done

## Story
**As a** user,
**I want** to see a list of all my conversations on the homepage,
**so that** I can easily navigate between different conversation sessions.

## Acceptance Criteria
1. Homepage displays list of all conversations with titles and timestamps
2. Each conversation shows creation date and last modified time
3. Users can click on conversations to navigate to the conversation canvas
4. "New Conversation" button creates a new conversation with auto-generated title
5. Conversation titles are displayed in a clean, readable format
6. Empty state is shown when no conversations exist
7. Responsive design works on desktop and tablet devices

## Tasks / Subtasks
- [x] Task 1: Create HomePage component structure (AC: 1, 2, 5, 6, 7)
  - [x] Create `src/components/pages/HomePage.tsx` component
  - [x] Implement conversation list display with titles and timestamps
  - [x] Add responsive design for desktop and tablet
  - [x] Create empty state component for no conversations
  - [x] Style conversation items with clean, readable format
- [x] Task 2: Implement conversation data fetching (AC: 1, 2)
  - [x] Create `src/services/frontendConversationService.ts` for API calls
  - [x] Implement `getConversations()` method to fetch all conversations
  - [x] Add loading states and error handling
  - [x] Format timestamps for display (creation date, last modified)
- [x] Task 3: Add navigation functionality (AC: 3, 4)
  - [x] Implement click handlers for conversation navigation
  - [x] Create "New Conversation" button with auto-generated title
  - [x] Add routing to `/chat/[id]` for conversation canvas
  - [x] Handle conversation creation and immediate navigation
- [x] Task 4: Create reusable UI components (AC: 5, 7)
  - [x] Create `src/components/ui/Button.tsx` for consistent button styling
  - [x] Create `src/components/ui/LoadingSpinner.tsx` for loading states
  - [x] Create `src/components/ui/ConversationCard.tsx` for conversation items
  - [x] Ensure components follow design system standards
- [x] Task 5: Implement responsive design and styling (AC: 7)
  - [x] Use Tailwind CSS for responsive grid layout
  - [x] Ensure proper mobile and tablet breakpoints
  - [x] Test layout on different screen sizes
  - [x] Follow consistent spacing and typography
- [x] Task 6: Create comprehensive test suite (AC: 1-7)
  - [x] Unit tests for HomePage component rendering
  - [x] Unit tests for conversation service API calls
  - [x] Integration tests for navigation functionality
  - [x] Responsive design tests for different screen sizes
  - [x] Empty state and error handling tests

## Dev Notes

### Previous Story Insights
From Story 1.2 completion:
- Conversation CRUD API endpoints are available at `/api/conversations`
- Mongoose schemas and data models are implemented
- Error handling utilities are available in `src/utils/errorHandler.ts`
- TypeScript types for Conversation are defined in `src/types/index.ts`
- Database connection and health check are working

### Component Architecture
**HomePage Component Structure:**
```typescript
// src/components/pages/HomePage.tsx
interface HomePageProps {
  // No props needed - fetches data internally
}

export const HomePage: React.FC<HomePageProps> = () => {
  const [conversations, setConversations] = useState<Conversation[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Component implementation
};
```
[Source: architecture/frontend-architecture.md#component-organization]

**ConversationCard Component:**
```typescript
// src/components/ui/ConversationCard.tsx
interface ConversationCardProps {
  conversation: Conversation;
  onClick: (conversationId: string) => void;
}

export const ConversationCard: React.FC<ConversationCardProps> = ({
  conversation,
  onClick
}) => {
  // Card implementation with title, timestamps, click handler
};
```
[Source: architecture/frontend-architecture.md#component-template]

### API Integration
**Conversation Service Implementation:**
```typescript
// src/services/conversationService.ts
export class ConversationService {
  static async getConversations(): Promise<Conversation[]> {
    return apiClient.request<Conversation[]>('/conversations');
  }
  
  static async createConversation(title: string): Promise<Conversation> {
    return apiClient.request<Conversation>('/conversations', {
      method: 'POST',
      body: JSON.stringify({ title }),
    });
  }
}
```
[Source: architecture/frontend-architecture.md#service-example]

**API Client Setup:**
```typescript
// src/services/apiClient.ts
class ApiClient {
  private baseUrl = '/api';
  
  async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {
    const response = await fetch(`${this.baseUrl}${endpoint}`, {
      headers: {
        'Content-Type': 'application/json',
        ...options.headers,
      },
      ...options,
    });
    
    if (!response.ok) {
      throw new Error(`API Error: ${response.status}`);
    }
    
    return response.json();
  }
}
```
[Source: architecture/frontend-architecture.md#api-client-setup]

### Data Models
**Conversation Interface (already defined):**
```typescript
interface Conversation {
  id: string;
  title: string;
  createdAt: Date;
  updatedAt: Date;
  nodes: Node[];
  edges: Edge[];
  metadata: ConversationMetadata;
}

interface ConversationMetadata {
  nodeCount: number;
  lastActiveNodeId?: string;
  tags?: string[];
}
```
[Source: architecture/data-models.md#conversation]

### File Locations
**Components to Create:**
- `src/components/pages/HomePage.tsx` - Main homepage component
- `src/components/ui/Button.tsx` - Reusable button component
- `src/components/ui/LoadingSpinner.tsx` - Loading state component
- `src/components/ui/ConversationCard.tsx` - Conversation list item component

**Services to Create:**
- `src/services/conversationService.ts` - API service for conversations
- `src/services/apiClient.ts` - Base API client utility

**Page Route:**
- `src/app/page.tsx` - Homepage route (modify existing)
[Source: architecture/frontend-architecture.md#component-organization]

### Routing Architecture
**Homepage Route:**
```typescript
// src/app/page.tsx
export default function HomePage() {
  return <HomePage />;
}
```

**Conversation Navigation:**
- Click on conversation card navigates to `/chat/[id]`
- "New Conversation" button creates conversation and navigates to canvas
- Use Next.js `useRouter` for programmatic navigation
[Source: architecture/frontend-architecture.md#route-organization]

### UI/UX Requirements
**Responsive Design:**
- Desktop: Grid layout with multiple columns
- Tablet: Single column with larger cards
- Mobile: Stacked layout with full-width cards
- Use Tailwind CSS responsive utilities (`sm:`, `md:`, `lg:`)

**Conversation Display:**
- Show conversation title prominently
- Display creation date and last modified time
- Show node count from metadata
- Hover effects for interactive elements
- Clean, readable typography

**Empty State:**
- Friendly message when no conversations exist
- Call-to-action to create first conversation
- Illustrative icon or graphic
[Source: architecture/frontend-architecture.md#component-organization]

### State Management
**Local State Pattern:**
```typescript
const [conversations, setConversations] = useState<Conversation[]>([]);
const [isLoading, setIsLoading] = useState(true);
const [error, setError] = useState<string | null>(null);
```
[Source: architecture/frontend-architecture.md#state-structure]

**State Management Patterns:**
- **Centralized State:** Single source of truth for conversation data
- **Immutable Updates:** All state changes through setState
- **Optimistic Updates:** Immediate UI updates with rollback on failure
- **Error Handling:** Proper error states and user feedback
[Source: architecture/frontend-architecture.md#state-management-patterns]

### Technical Constraints
- **Next.js App Router:** Use App Router pattern for routing
- **TypeScript:** All components must be fully typed
- **Tailwind CSS:** Use utility-first CSS approach
- **API Calls:** Use service layer, never direct fetch calls
- **Error Handling:** Implement proper error boundaries and user feedback
- **Responsive Design:** Mobile-first approach with proper breakpoints
[Source: architecture/coding-standards.md, architecture/frontend-architecture.md]

### Testing Requirements
**Test File Locations:**
- `tests/components/HomePage.test.tsx` - Homepage component tests
- `tests/components/ui/ConversationCard.test.tsx` - Card component tests
- `tests/services/conversationService.test.ts` - Service layer tests

**Testing Standards:**
- **Frontend Testing:** Jest + React Testing Library
- **Test Organization:** Follow testing pyramid with unit tests, integration tests
- **Mocking:** Mock API calls and external dependencies
- **Accessibility:** Test keyboard navigation and screen reader compatibility
[Source: architecture/testing-strategy.md#frontend-tests]

**Specific Test Cases:**
- Unit tests for HomePage component rendering
- Unit tests for conversation service API calls
- Integration tests for navigation functionality
- Responsive design tests for different screen sizes
- Empty state and error handling tests
- Accessibility tests for keyboard navigation
[Source: architecture/testing-strategy.md#frontend-component-test]

### Project Structure Notes
The current project structure already has:
- `src/app/page.tsx` exists (needs modification)
- `src/components/` directory structure exists
- `src/services/` directory exists
- `src/types/` with Conversation types defined

The main work is to:
1. Create the HomePage component and UI components
2. Implement the conversation service for API calls
3. Modify the existing homepage route
4. Add responsive design and styling
5. Ensure proper error handling and loading states

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
Claude Sonnet 4 (Dev Agent)

### Debug Log References
- All tests passing for frontend components and services
- Minor test fixes for date formatting and accessibility attributes
- API client test fixed for header ordering

### Completion Notes List
- ✅ HomePage component created with full conversation list functionality
- ✅ Responsive design implemented with Tailwind CSS (desktop, tablet, mobile)
- ✅ Empty state and error handling implemented
- ✅ Navigation functionality working with Next.js router
- ✅ Reusable UI components created (Button, LoadingSpinner, ConversationCard)
- ✅ Frontend conversation service created for API integration
- ✅ Comprehensive test suite created with 58+ passing tests
- ✅ All acceptance criteria met

### File List
**New Files Created:**
- `src/components/pages/HomePage.tsx` - Main homepage component
- `src/components/ui/Button.tsx` - Reusable button component
- `src/components/ui/LoadingSpinner.tsx` - Loading state component
- `src/components/ui/ConversationCard.tsx` - Conversation list item component
- `src/services/apiClient.ts` - Base API client utility
- `src/services/frontendConversationService.ts` - Frontend conversation service
- `tests/components/pages/HomePage.test.tsx` - HomePage component tests
- `tests/components/ui/Button.test.tsx` - Button component tests
- `tests/components/ui/LoadingSpinner.test.tsx` - LoadingSpinner component tests
- `tests/components/ui/ConversationCard.test.tsx` - ConversationCard component tests
- `tests/services/apiClient.test.ts` - API client tests
- `tests/services/frontendConversationService.test.ts` - Frontend service tests

**Modified Files:**
- `src/app/page.tsx` - Updated to use HomePage component
- `jest.config.mjs` - Updated to use jsdom environment for React tests
- `jest.setup.js` - Added testing library setup

## QA Results
*Results from QA Agent review will be populated here after implementation*
